<project name="Scriptella Documentation Build" default="codereports">
    <property file="custom.build.properties"/>
    <property file="build.properties"/>
    <property name="docs.dir" value="${basedir}/build/docs"/>
    <property name="dtd.dest.dir" value="${docs.dir}/dtd"/>
    <property name="javadoc.dest.dir" value="${docs.dir}/api"/>
    <property name="site.dir" value="${basedir}/forrest/src/documentation/content"/>
    <path id="class.path">
        <fileset dir="lib" includes="**/*.jar"/>
    </path>

    <target name="codereports" depends="dtd, javadoc"/>
    <target name="dtd" depends="clean">
        <description>Generates DTD using DTDDoc</description>
        <!--Validation-->
        <fail message="DTDDoc is required to build DTD documentation. Set dtddoc.dir property.
        DTDDoc URL: http://dtddoc.sourceforge.net" unless="dtddoc.dir"/>
        <condition property="no_dtddoc">
            <available file="${dtddoc.dir}"/>
        </condition>
        <fail message="DTDDoc not found in ${dtddoc.dir}" unless="no_dtddoc"/>
        <!--End Validation-->
        <taskdef name="DTDDoc"
                 classname="DTDDoc.DTDDocTask">
            <classpath>
                <fileset dir="${dtddoc.dir}" includes="*.jar"/>
            </classpath>
        </taskdef>
        <mkdir dir="${dtd.dest.dir}"/>
        <DTDDoc showHiddenTags="true"
                showFixmeTags="false"
                sourceDir="core/src/conf"
                destDir="${dtd.dest.dir}"
                docTitle="DTD Documentation">
            <include name="**/*.dtd"/>
        </DTDDoc>
        <copy todir="${dtd.dest.dir}" flatten="true">
            <fileset dir="${basedir}/core/src/conf" includes="**/*.dtd"/>
        </copy>
    </target>

    <target name="javadoc" depends="clean">
        <mkdir dir="${javadoc.dest.dir}"/>
        <javadoc destdir="${javadoc.dest.dir}" includenosourcepackages="true"
                 use="true" windowtitle="Scriptella API Documentation">
            <classpath refid="class.path"/>
            <classpath path="${ant.jar}"/>
            <packageset dir="core/src/java"/>
            <packageset dir="drivers/src/java"/>
            <packageset dir="tools/src/java"/>
            <doctitle><![CDATA[<h1>Scriptella API Documentation</h1>]]></doctitle>
            <bottom>
                <![CDATA[<i>Copyright &#169; Copyright 2006-2009 The <a href="http://scriptella.javaforge.com">Scriptella Project</a> Team.</i>]]></bottom>
        </javadoc>
    </target>

    <target name="clean" unless="noclean">
        <delete dir="${dtd.dest.dir}" failonerror="no"/>
        <delete dir="${javadoc.dest.dir}" failonerror="no"/>
        <delete failonerror="no">
            <fileset dir="${site.dir}" includes="docs/** dtd/**"/>
        </delete>
    </target>
    <target name="site" description="Prepares site" depends="codereports">
        <!-- Copy generate docs to forrest site-->
        <copy todir="${site.dir}/docs">
            <fileset dir="${docs.dir}"/>
        </copy>
        <!--Copy DTDs to site dtd directory. Registered URLs for DTDs -->
        <copy todir="${site.dir}/dtd">
            <fileset dir="${dtd.dest.dir}" includes="*.dtd"/>
        </copy>
        <antcall target="forrest"/>
    </target>

    <target name="forrest">
        <!--Validation-->
        <condition property="no_forrest">
            <available file="${forrest.dir}"/>
        </condition>
        <fail message="Forrest is required to build a site. Set forrest.dir property.
        Forrest URL: http://forrest.apache.org" unless="no_forrest"/>
        <!--End Validation-->
        <!--<ant antfile="${forrest.home}/main/forrest.build.xml" dir="forrest"/>-->
        <!--Forrest needs a patched ant ;), so let's call sh/bat file instead -->
        <condition property="ext" value=".bat">
            <os family="windows"/>
        </condition>
        <property name="ext" value=""/>
        <exec dir="forrest" executable="${forrest.dir}/bin/forrest${ext}"/>
    </target>

    <target name="site_postprocess" description="Additional postprocessing for statistics and other HTML changes">
        <!-- StatCounter -->
        <replace dir="${basedir}/forrest/build/site">
            <include name="**/*.html"/>
            <exclude name="docs/** dtd/**"/>
            <replacetoken><![CDATA[</div>
</body>
</html>
]]></replacetoken>
            <replacevalue><![CDATA[</div>
<!-- Start of StatCounter Code -->
<script type="text/javascript" language="javascript">
var sc_project=2292342;
var sc_invisible=1;
var sc_partition=21;
var sc_security="748ecb1a";
</script>

<script type="text/javascript" language="javascript" src="http://www.statcounter.com/counter/counter.js"></script><noscript><a href="http://www.statcounter.com/" target="_blank"><img  src="http://c22.statcounter.com/counter.php?sc_project=2292342&java=0&security=748ecb1a&invisible=1" alt="free stats" border="0"></a> </noscript>
<!-- End of StatCounter Code -->
</body>
</html>]]></replacevalue>
        </replace>
        <!-- Bookmarks + PayPal -->
        <replace dir="${basedir}/forrest/build/site">
            <include name="**/*.html"/>
            <exclude name="docs/** dtd/**"/>
            <replacetoken><![CDATA[<div id="credit"></div>]]></replacetoken>
            <replacevalue><![CDATA[<div id="credit">
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" onclick="window.open('http://www.addthis.com/bookmark.php?pub=ejboy&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title), 'addthis', 'scrollbars=yes,menubar=no,width=620,height=520,resizable=yes,toolbar=no,location=no,status=no'); return false;" title="Bookmark using any bookmark manager!" target="_blank"><img src="http://www.addthis.com/images/button1-bm.gif" width="125" height="16" border="0" alt="AddThis Social Bookmark Button" /></a>
<!-- AddThis Bookmark Button END -->
<br>
<br>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</div>]]>
            </replacevalue>
        </replace>
    </target>


</project>
