<project name="Scriptella Documentation Build" default="codereports">
    <property file="custom.build.properties"/>
    <property file="build.properties"/>
    <property name="docs.dir" value="${basedir}/build/docs"/>
    <property name="dtd.dest.dir" value="${docs.dir}/dtd"/>
    <property name="javadoc.dest.dir" value="${docs.dir}/api"/>
    <property name="site.dir" value="${basedir}/forrest/src/documentation/content"/>
    <path id="class.path">
        <fileset dir="lib" includes="**/*.jar"/>
    </path>

    <target name="codereports" depends="dtd, javadoc"/>
    <target name="dtd" depends="clean">
        <description>Generates DTD using DTDDoc</description>
        <!--Validation-->
        <condition property="no_dtddoc">
            <available file="${dtddoc.dir}"/>
        </condition>
        <fail message="DTDDoc is required to build DTD documentation. Set dtddoc.dir property.
        DTDDoc URL: http://dtddoc.sourceforge.net" unless="no_dtddoc"/>
        <!--End Validation-->
        <taskdef name="DTDDoc"
                 classname="DTDDoc.DTDDocTask">
            <classpath>
                <fileset dir="${dtddoc.dir}" includes="*.jar"/>
            </classpath>
        </taskdef>
        <mkdir dir="${dtd.dest.dir}"/>
        <DTDDoc showHiddenTags="true"
                showFixmeTags="false"
                sourceDir="core/src/conf"
                destDir="${dtd.dest.dir}"
                docTitle="DTD Documentation">
            <include name="**/*.dtd"/>
        </DTDDoc>
        <copy todir="${dtd.dest.dir}" flatten="true">
            <fileset dir="${basedir}/core/src/conf" includes="**/*.dtd"/>
        </copy>
    </target>

    <target name="javadoc" depends="clean">
        <mkdir dir="${javadoc.dest.dir}"/>
        <javadoc destdir="${javadoc.dest.dir}" includenosourcepackages="true"
                 use="true" windowtitle="Scriptella API Documentation">
            <classpath refid="class.path"/>
            <classpath path="${ant.jar}"/>
            <packageset dir="core/src/java"/>
            <packageset dir="drivers/src/java"/>
            <packageset dir="tools/src/java"/>
            <doctitle><![CDATA[<h1>Scriptella API Documentation</h1>]]></doctitle>
            <bottom>
                <![CDATA[<i>Copyright &#169; Copyright 2006-2007 The <a href="http://scriptella.javaforge.com">Scriptella Project</a> Team.</i>]]></bottom>
        </javadoc>
    </target>

    <target name="clean" unless="noclean">
        <delete dir="${dtd.dest.dir}" failonerror="no"/>
        <delete dir="${javadoc.dest.dir}" failonerror="no"/>
        <delete failonerror="no">
            <fileset dir="${site.dir}" includes="docs/** dtd/**"/>
        </delete>
    </target>
    <target name="site" description="Prepares site" depends="codereports">
        <!-- Copy generate docs to forrest site-->
        <copy todir="${site.dir}/docs">
            <fileset dir="${docs.dir}"/>
        </copy>
        <!--Copy DTDs to site dtd directory. Registered URLs for DTDs -->
        <copy todir="${site.dir}/dtd">
            <fileset dir="${dtd.dest.dir}" includes="*.dtd"/>
        </copy>
        <antcall target="forrest"/>
    </target>

    <target name="forrest">
        <!--Validation-->
        <condition property="no_forrest">
            <available file="${forrest.dir}"/>
        </condition>
        <fail message="Forrest is required to build a site. Set forrest.dir property.
        Forrest URL: http://forrest.apache.org" unless="no_forrest"/>
        <!--End Validation-->
        <!--<ant antfile="${forrest.home}/main/forrest.build.xml" dir="forrest"/>-->
        <!--Forrest needs a patched ant ;), so let's call sh/bat file instead -->
        <condition property="ext" value=".bat">
            <os family="windows"/>
        </condition>
        <property name="ext" value=""/>
        <exec dir="forrest" executable="${forrest.dir}/bin/forrest${ext}"/>
    </target>

    <target name="site_postprocess" description="Additional postprocessing for statistics and other HTML changes">
        <!-- Google Analytics -->
        <replace dir="${basedir}/forrest/build/site">
            <include name="**/*.html"/>
            <exclude name="docs/** dtd/**"/>
            <replacetoken><![CDATA[</div>
</body>
</html>
]]></replacetoken>
                <replacevalue><![CDATA[</div>
<!-- Start of StatCounter Code -->
<script type="text/javascript" language="javascript">
var sc_project=2292342;
var sc_invisible=1;
var sc_partition=21;
var sc_security="748ecb1a";
</script>

<script type="text/javascript" language="javascript" src="http://www.statcounter.com/counter/counter.js"></script><noscript><a href="http://www.statcounter.com/" target="_blank"><img  src="http://c22.statcounter.com/counter.php?sc_project=2292342&java=0&security=748ecb1a&invisible=1" alt="free stats" border="0"></a> </noscript>
<!-- End of StatCounter Code -->
</body>
</html>]]></replacevalue>
        </replace>

        <!-- Bookmarks + PayPal -->
        <replace dir="${basedir}/forrest/build/site">
            <include name="**/*.html"/>
            <exclude name="docs/** dtd/**"/>
            <replacetoken><![CDATA[<div id="credit"></div>]]></replacetoken>
            <replacevalue><![CDATA[<div id="credit">
<!-- AddThis Bookmark Button BEGIN -->
<a href="http://www.addthis.com/bookmark.php" onclick="window.open('http://www.addthis.com/bookmark.php?pub=ejboy&url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title), 'addthis', 'scrollbars=yes,menubar=no,width=620,height=520,resizable=yes,toolbar=no,location=no,status=no'); return false;" title="Bookmark using any bookmark manager!" target="_blank"><img src="http://www.addthis.com/images/button1-bm.gif" width="125" height="16" border="0" alt="AddThis Social Bookmark Button" /></a>
<!-- AddThis Bookmark Button END -->
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</div>]]>
</replacevalue>
        </replace>
    </target>


</project>
