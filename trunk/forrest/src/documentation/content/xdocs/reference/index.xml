<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "dtd/document-v20.dtd">
<document>
	<header>
		<title>Scriptella Reference Documentation</title>
		<authors>
			<person name="Fyodor Kupolov" email="kupolov@gmail.com"/>
		</authors>
		<notice>Version 0.2dev. Work in progress</notice>
		<abstract class="pageBreakAfter">
			<img src="../images/site-logo.png" alt=""/>
		</abstract>
	</header>
	<body>
		<section>
			<title>Introduction</title>
			<p>Scriptella is a Java-based ETL and scripts execution tool. The primary scripting language is a plain old SQL executed by the JDBC bridge.
			At the same time other non-JDBC providers could be easily added allowing to mix SQL scripts with other scripting languages.</p>
			<p>The following diagram is an overview of the Scriptella execution model:</p>
			<figure src="../images/reference/intro.gif" alt="Architecture Overview"/>
			<section>
				<title>When to use</title>
				<p>There is no silver bullet and you have to pick a right tool aligned with your goals. Here is a list of scenarios when Scriptella may be a very helpful tool:</p>
				<ul>
					<li>Storing database SQL scripts. Scriptella allows you to easily execute SQL scripts without dependencies on database vendor SQL tools. Moreover you can reference BLOB content, e.g. files, and use other JDBC features in your scripts.</li>
					<li>Working with several datasources. For example gathering statistics from the one database and store it inside the other one</li>
					<li>If you prefer to write <source>SELECT * FROM Account WHERE login=?name</source> instead of using a "Smart Query Designer GUI"</li>
					<li>Test data generation. You don't have to store huge random filled test files - produce
                    test data during script execution.</li>
				</ul>
				<p>Of course there are situations when you'd probably try to find a better tool:</p>
				<ul>
					<li>Database replication,i.e. one-to-one copy of the database content. There are plenty of tools doing this job easier.</li>
				</ul>
			</section>
		</section>
		<section>
			<title>System Requirements</title>
			<p>Scriptella requires JDK or JRE version 5.0 or later to operate.</p>
			<p>The memory requirements are dependant on your script content and referenced connection providers. For example if in-process database connections are used inside a script we recommend to use at least 512Mb of RAM.</p>
		</section>
		<section>
			<title>Installation</title>
			<anchor id="INSTALLATION"/>
			<ul>
				<li>
					<a href="../download.html">Download</a> Scriptella binary distribution.</li>
				<li>Unpack it and add a &lt;SCRIPTELLA_DIR&gt;/bin to system path variable.</li>
				<li>Check if JRE has been installed correctly by running java -version. Alternatively JAVA_HOME may be used to specify JDK location.
				<p>Use <code>set PATH=%PATH%;SCRIPTELLA_DIR\bin</code> for Windows and <code>export PATH=${PATH}:SCRIPTELLA_DIR/bin</code> for Unix.</p>
				</li>
				<li>
					<em>Optional step:</em> Put JDBC drivers required by your scripts to &lt;SCRIPTELLA_DIR&gt;/lib directory
                    or directly specify classpath attribute in script connection elements.</li>
			</ul>
			<p>The binary distribution of Scriptella consists of the following directory layout:</p>
			<source>
+-+
  +--- bin - launch scripts
  |
  +--- docs - documentation
  |      +--- api - API Documentation (in Javadoc format)
  |      |
  |      +--- dtd - Scriptella DTD file and documentation in DTDDoc format.
  +--- lib - scriptella boot class path libraries loaded by launch scripts.
            </source>
			<p>Among other libraries the Scriptella distribution contains the following jars:</p>
			<ul>
				<li>
					<code>scriptella-core.jar</code> - Scriptella core classes required to operate</li>
				<li>
					<code>scriptella-drivers.jar</code> - Built in drivers and adapters for different datasources</li>
				<li>
					<code>scriptella-tools.jar</code> - Misc tools, Ant and command line launchers</li>
				<li>
					<code>scriptella.jar</code> - All-In-One jar containing all dependencies except the driver specific. You have to load additional driver dependencies in a connection classpath attrubute or by putting the jars into lib folder.</li>
			</ul>
		</section>
		<section>
			<title>Scripts Syntax</title>
			<note>For details about all XML elements consult a <a href="../docs/dtd/">Scriptella DTD Documentation</a>
			</note>
			<p>The following XML stanza briefly covers main Scriptella XML elements:</p>
			<source><![CDATA[
<!DOCTYPE etl SYSTEM "http://scriptella.javaforge.com/dtd/etl.dtd">
<etl>
    <description></description>
    <properties>
        <include href="script.properties"/>
        driver=org.jdcDriver
    </properties>
    <connection id="con1" driver="$driver" url="${url}" user="$user" password="12345678">
        driver.property=value
    </connection>
    <connection id="con2" driver="org.hsqldb.jdbcDriver" url="jdbc:hsqldb:file:db" user="sa" password=""/>
    <script connection-id="out">
	    <include href="dbschema.sql"/>
    </script>
    <query connection-id="in">
        SELECT * from Bug
        <script connection-id="out">
            INSERT INTO Bug VALUES (?ID, ?priority, ?summary, ?status);
        </script>
    </query>
</etl>]]></source>
			<p>&lt;etl&gt; is a root element of all Scriptella files.</p>
			<section>
				<title>&lt;properties&gt;</title>
				<p>In this element define properties to be substituted in other script elements. This concept is similar to
                Ant.</p>
				<p>&lt;include&gt; element is used to insert external content. This concept is almost identical to XInclude</p>
				<note>The values of properties defined in this element are overridden by system properties or other
                external properties depending on execution environment, e.g. Ant properties.</note>
			</section>
			<section>
				<title>&lt;connection&gt;</title>
				<p>Elements of this type define connections to different datasources to work with.
                    A set of required attributes depends on driver. For example JDBC drivers require
                    driver, url, user and password attributes. Additionally you may specify catalog/schema attributes.</p>
				<p>
					<strong>id</strong> attribute is required if you declare more than one connections inside your script.
                    The value of this attribute is used to reference the connection in scripts and queries.</p>
				<p>
					<strong>classpath</strong> optional attribute is used to specify additional classpath to load driver libraries.
                    .Paths are colon/semicolon separated and resolved relative to a directory where ETL file resides.
                    Absolute URLs are also supported, e.g. ftp://server/jconnect.jar;http://server2/classes12.zip
                    Alternatively you can add drivers jars to scriptella boot classpath (SCRIPTELLA_DIR/lib directory or in Ant taskdef classpath).
                    Boot classpath libraries take precedence over libraries specified in connection classpath attribute.
                </p>
                <p>
                    <strong>lazy-init</strong> optional attribute specifies connection initialization strategy.
                    <code>true</code> if connection initialization should be deferred until it is actually used.
                    The default value of <code>false</code> means that connection is initialized on ETL startup.
                    Lazy connection initialization may be useful in following cases:
                    <ul>
                        <li>A script or a query operating with this connection has conditional <b>if</b> attribute, in
                        this case greedy initialization may be redundant</li>
                        <li>Other connections create database users or produce files required for this connection
                        to be initialized properly.</li>
                    </ul>
                </p>

                <p>Use element's content to pass properties into connection. Several driver also support
                connection properties in URL string.</p>
			</section>
			<section>
				<title>&lt;script&gt;</title>
				<p>Elements of this type contain executable content. The script language is connection specific.
                    This element supports the following optional attributes:</p>
				<p>
					<strong>connection-id</strong> attribute specifies a connection identifier.</p>
				<p>
					<strong>new-tx</strong> attribute specifies transaction semantics. If new-tx=true a dedicated
                    connection is used instead of the global one.
                </p>
				<p>
					<strong>if</strong> attribute is used for conditional execution. The element content is executed
                    only if the result of this attribute value evaluation is true. For example <br/>
					<code>&lt;script if="rownum gt 1 and name!=null and name.length() gt 0"&gt;</code>
					<br/>
                    is evaluated only if rownum variable has value greater than 1 and the name variable is not empty.
                </p>
				<p>
					<strong>Example</strong>
				</p>
				<source>
                    &lt;--A script executed in a separate connection(new-tx=true)
                    if drop_tables property has been set to true. --&gt;
                    &lt;connection id="in" ...&gt;
                    ....
                    &lt;script connection-id="in" new-tx="true" if="drop_tables"&gt;
                        DROP TABLE Table1;
                        DROP TABLE Table2;
                    &lt;/script&gt;
                </source>
			</section>
			<section>
				<title>&lt;query&gt;</title>
				<p>Elements of this type contain query expressions. The query language is connection specific.
                    This element supports the following optional attributes:</p>
				<p>
					<strong>connection-id</strong> attribute specifies a connection identifier.
                    By default connection ID is inherited for child elements, but may be overriden.</p>
				<p>
					<strong>if</strong> attribute is used for conditional execution. The element content is executed
                    only if the result of this attribute value evaluation is true. For example <br/>
					<code>&lt;query if="migrate_users"&gt;</code>
					<br/>
                    is evaluated only if migrate_users variable has value of true, 1, on or yes.
                </p>
				<p>
					<strong>Example</strong>
				</p>
				<source><![CDATA[
                    <!--Declare connections -->;
                    <connection id="in" .../>;
                    <connection id="out" .../>;
                    ....
                    <!--Query selects users and executes nested elements if migrate_users is on-->;
                    <query connection-id="in" if="migrate_users">
                        SELECT * FROM Users;
                        <!--For each row sends LDIF entry to a directory server-->
                        <script connection-id="out">
                            dn: uid=$user_name,ou=people,dc=scriptella
                            objectClass: inetOrgPerson
                            uid: $user_name
                            cn: $user_name
                        </script>
                    </query>]]></source>
			</section>
			<fixme author="ejboy">Describe all elements</fixme>
		</section>
		<section>
			<title>Expressions and Variables Substitution</title>
			<p>Scriptella supports variables substitution and expression evaluation based on the following syntax:</p>
			<ul>
				<li>$Property_Name - inserts a value of the specified property or variable.
                    $ prefixed expressions are substituted in all parts except comments.</li>
				<li>${expression} - inserts a value of the expression evaluation.
                    <a href="http://jakarta.apache.org/commons/jexl">JEXL</a> syntax is used for expressions.</li>
				<li>?Propery_Name or ?{expression} are used in SQL queries and scripts to set prepared statement parameters.
                ? prefixed expressions are not substituted inside quotes and comments.</li>
			</ul>
			<warning>
                In SQL scripts and queries try to minimize usages of <strong>$</strong>, use <strong>?</strong> instead.
                In this case prepared statements may be cached thus increasing the performance of hot spot sections evaluated multiple times.
                Use $ for direct substitution only if you have problems passing prepared statement parameters via ?, ?{} syntax.
            </warning>
			<note>
                This syntax is only valid for Scriptella connection element attributes,
                <code>if</code> attribute of <code>&lt;query&gt;/&lt;script&gt;</code> elements
                and SQL scripts/queries processed by the JDBC Provider,
                other providers may not support properties/expressions substitution or use alternative syntax, e.g. in Janino
                you'll have to use get(name) to get value of the variable.
                For details on variables/expressions syntax consult a <a href="../docs/api/">Javadoc</a> of your driver.
            </note>
			<section>
				<title>Implicit Variables</title>
				<p>Scriptella supports the following implicit variables in scripts and queries:</p>
				<table>
					<tr>
						<th>Variable</th>
						<th>Description</th>
						<th>Scope</th>
					</tr>
					<tr>
						<td>
							<code>rownum</code>
						</td>
						<td>Represents row number of query row set. Starts with 1.</td>
						<td>Nested elements of Query</td>
					</tr>
				</table>
				<p>Additionally SQL queries produce a set of implicit variables corresponding to selected column names.
                    These variables are available in nested elements.
                Columns may also be referenced using a result set column number, e.g. ?1, ?2 ,...</p>
			</section>
			<section>
				<title>Adding references to files from SQL scripts</title>
				<p>The JDBC bridge supports referencing file content via</p>
				<source>?{file &lt;Expression&gt;}</source>
				<p>syntax.
                Where Expression is any valid JEXL expression, e.g. <code>'file.dat'</code> or <code>protocol+path</code>
				</p>
				<p>File references are set as prepared statement parameters of stream type, so you can reference
                LOBs of any size supported by your database driver.</p>
				<note>Music Store example demonstrates usage of file references</note>
			</section>
			<section>
				<title>Examples</title>
				<p>Execute a SQL query for table specified by TABLE  property and inserts the first row into TABLE2</p>
				<source><![CDATA[
    <connection driver="hsqldb"/> <!--JDBC Bridge Driver-->
    <query>
        SELECT V1, V2, V3 from $TABLE;
        <script if="rownum==1">
            INSERT INTO $TABLE2 VALUES (?V1, ?{V2+V3});
        </script>
    </query>]]></source>
			</section>
		</section>
		<section>
			<title>Command Line Execution</title>
			<p>If you followed the <a href="#INSTALLATION">Installation</a> instructions running Scriptella is simple - just type <code>scriptella</code> to execute a <code>etl.xml</code> in the current directory.</p>
			<p>The Scriptella launching script loads all jars from SCRIPTELLA_DIR/lib directory and adds them to executed script(s) class path.</p>
			<p>Alternatively a standard java launcher may be used to run a script:
			<code>java -jar scriptella.jar [options] [file1] [file2] ... [fileN]</code>. It is assumed that the scriptella.jar file from the binary distribution is available in the current directory.</p>
			<note label="Important">Java launcher does NOT load jars from lib directory so you would have to specify additional class path elements in script file connection declarations or use java -Xbootclasspath/a:path/to/driver1.jar;path/to/driver2.jar -jar scriptella.jar to overcome -jar option limitation.</note>
			<section>
				<title>Command Line Options</title>
				<p>The scriptella launcher has the following invocation syntax:</p>
				<source>scriptella [options] [file1] [file2] ... [fileN]</source>
				<p>File names/paths are specified after options and separated by spaces.</p>
				<table>
					<tr>
						<td>-help, -h</td>
						<td>display help</td>
					</tr>
					<tr>
						<td>-debug, -d</td>
						<td>print debugging information</td>
					</tr>
					<tr>
						<td>-quiet, -q</td>
						<td>be extra quiet</td>
					</tr>
					<tr>
						<td>-version, -v</td>
						<td>print version</td>
					</tr>
                    <tr>
                        <td>-template, -t</td>
                        <td>creates an etl.xml template file in the current directory</td>
                    </tr>
                </table>
			</section>
			<fixme author="ejboy">Describe command line tools</fixme>
		</section>
		<section>
			<title>Ant Integration</title>
			<section>
				<title>System requirements</title>
				<p>Ant 1.6 or later is recommended.</p>
			</section>
			<section>
				<title>Installation</title>
				<p>Use scriptella.jar from the binary distribution. This file contains all necessary classes and
                    resources for integration with Ant.</p>
				<p>In order to use scriptella as Ant task you will need the following taskdef declaration:</p>
				<source><![CDATA[<taskdef resource="antscriptella.properties" classpath="/path/to/scriptella.jar"/>]]></source>
				<p>You may also add paths to database drivers used inside the script:</p>
				<source><![CDATA[<taskdef resource="antscriptella.properties"
   <classpath>
       <pathelement location="/path/to/scriptella.jar">
       <pathelement location="lib/hsqldb.jar">
       <pathelement location="lib/jconn2.jar">
   </classpath>
</taskdef>]]></source>
			</section>
			<p>These drivers will be available on the boot classpath.
                In this case you don't have to specify classpath in &lt;connection&gt; elements.</p>
			<section>
				<title>Scriptella &quot;etl&quot; Task</title>
				<section>
					<title>Parameters</title>
					<table>
						<tr>
							<th>Attribute</th>
							<th>Description</th>
							<th>Required</th>
						</tr>
						<tr>
							<td>file</td>
							<td>The script file to execute.</td>
							<td>Yes, unless a nested &lt;fileset&gt; element is used.</td>
						</tr>
						<tr>
							<td>inheritAll</td>
							<td>If true, pass Ant project properties to the Script Executor.</td>
							<td>No, default value is <code>true</code>.</td>
						</tr>
						<tr>
							<td>debug</td>
							<td>If true, print debugging information.</td>
							<td>No, default value is false.</td>
						</tr>
						<tr>
							<td>quiet</td>
							<td>If true, be extra quiet.</td>
							<td>No, default value is false.</td>
						</tr>
					</table>
				</section>
				<section>
					<title>Nested Elements</title>
					<p>The task supports nested
                        <a href="http://ant.apache.org/manual/CoreTypes/fileset.html">&lt;fileset&gt;</a>
                        element.
                    </p>
				</section>
				<section>
					<title>Examples</title>
					<p>
						<strong>Executes etl.xml file in the current directory:</strong>
					</p>
					<source>&lt;etl/&gt;</source>
					<p>
						<strong>Executes name.etl.xml file in the current directory:</strong>
					</p>
					<source><![CDATA[<etl file="name" />;
<!--Or explicitly specifying the full name-->
<etl file="name.etl.xml" >]]></source>
					<p>
						<strong>Executes all .etl.xml files in db directory:</strong>
					</p>
					<source><![CDATA[<etl>
    <fileset dir="db" includes="*.etl.xml"/>;
</etl>]]></source>
				</section>
			</section>
		</section>
        <section id="inprocess">
            <title>In-Process Java Integration</title>
            <p>Although Ant and command line execution are the most typical usage scenarious, it may be helpful to
                invoke
                Scriptella directly from Java code. Typical use cases for in-process integration:</p>
            <ul>
                <li>Preparing datasources for testing. Example: create the database before a test case, and cleanup on
                    test completion.</li>
                <li>Creating/upgrading database schema on application startup. Example: creating a database on web
                    application initialization, very helpful in user friendly, zero-deployment or demo
                    applications.</li>
                <li>Custom migration solutions. Example: Client uploads a CSV file to a J2EE server and then Scriptella
                    managed ETL script imports CSV data into several database tables.</li>
            </ul>
            <p>The invocation from java code is simple:</p>
            <ul>
                <li>Make sure scriptella.jar is available on classpath.</li>
                <li>Use EtlExecutor.newExecutor to execute an ETL file. See
                    <a href="../docs/api/scriptella/execution/EtlExecutor.html">EtlExecutor Javadoc</a>
                    for more details.
                </li>
            </ul>
            <note>
                Typically you will need a
                <a href="drivers.html#spring">Spring Driver</a>
                or a
                <a href="drivers.html#jndi">JNDI Driver</a>
                to integrate with application deployment environment (Spring, J2EE or other).
            </note>
        </section>
        <section>
			<title>JDBC Adapters</title>
			<p>Scriptella is bundled with a set of adapters for popular
            JDBC drivers. You are free to use any JDBC vendor drivers, but
            the Scriptella adapters provide the following benefits:</p>
			<ul>
				<li>Simplified naming. No need to specify a full driver's class
                name, alias may be used, e.g. driver="hslqdb", "oracle" etc.</li>
				<li>Scriptella adapters are preconfigured for optimal performance, syntax parsing rules
                and other execution options, e.g. BLOB handling for oracle. In most cases
                you can specify a generic JDBC property, but using adapters simplifies
                switching between drivers and even a target platform e.g. Java/.Net</li>
			</ul>
			<p>See <a href="drivers.html#jdbcbridge">JDBC Bridge Drivers Matrix</a> for the complete list of supported adapters.</p>
			<note>
                Scriptella driver's package short name is an alias for driver, e.g. h2 is an alias
                for scriptella.driver.h2.Driver
            </note>
		</section>
		<section>
			<title>Non-relational Datasources Interoperability</title>
			<p>See <a href="drivers.html#nonjdbc">Non-JDBC Drivers Matrix</a> for the complete list of drivers.</p>
			<p>Additionally various JDBC bridge drivers can be used to work with specific datasources like LDAP directories,
                CSV files, XML files or object databases.
            </p>
			<section>
				<title>Accessing directories based on LDAP</title>
				<p>The feature of Scriptella is a possibility to write transformations
                    in a language suitable for the datasource you operate, so we've added a
                    <a href="drivers.html#ldap">built-in support</a>
                    for LDIF scripts and RFC 2254 search filter queries.
                </p>
				<p>Alternatively you can use the freely available
                    <a href="http://www.openldap.org/jdbcldap/">JDBC-LDAP Bridge Driver</a>
                    (JDBC-LDAP) to access information held in directories.
				This driver uses SQL-like syntax for scripts and queries. See
                    <a href="http://www.octetstring.com/support/jdbcldapdriver/GettingStarted.php">Getting Started
                        Documentation</a>. A similar driver is offered by Novell. See
                    <a href="http://developer.novell.com/ndk/doc/ldapjdbc/">LDAP JDBC Driver</a>
                    for more details.
                </p>
			</section>
			<section>
				<title>Working with CSV data</title>
				<p>The <a href="drivers.html#csv">built-in CSV driver</a> allows to easily query and generate CSV files.</p>
				<p>	HSQLDB <a href="http://www.hsqldb.org/doc/guide/ch06.html">text tables</a>
                    feature could be used to work
                    with CSV files.</p>
				<p>Additionally <a href="http://opencsv.sourceforge.net">opencsv</a> library can be used in Janino scripts.</p>
			</section>
			<section>
				<title>Using Java Code</title>
				<p>Although Scriptella was designed for JDBC/SQL datasources under some circumstances it is
				useful to embed or invoke Java from Scriptella file. The <a href="drivers.html#janino">Janino Provider</a>
				is bundled with Scriptella distribution and provides a Java bridge. This driver also exposes a set of properties and methods for <a href="../docs/api/scriptella/driver/janino/JaninoScript.html">&lt;script&gt;</a> and <a href="../docs/api/scriptella/driver/janino/JaninoQuery.html">&lt;query&gt;</a> elements.</p>
				<p>Scriptella has no equivalent of Ant Task API, although we provide two alternatives to integrate Java solutions:</p>
				<ul>
					<li>Writing a Service Provider Implementation (Scriptella Driver). This is the most powerful API, but it is harder to implement.</li>
					<li>Calling compiled code from Janino scripting elements. Just specify your jar as an additional class-path entry for Janino connection and you can work with any class from this jar. This approach is easy-to-use and do not add dependencies on Scriptella API to your classes/tasks.</li>
				</ul>
				<p>Other Java compilers or interpreters can also be plugged in via custom Scriptella Drivers.</p>
			</section>
			<section>
				<title>Producing Reports with Velocity</title>
				<p>Velocity is a Java-based template engine which can be used to generate reports. Most other ETL tools provides custom reporting services, but Scriptella relies on
				proven open source solutions instead of reinventing the wheel. The built-in <a href="drivers.html#velocity">Velocity Driver</a>
				allows using velocity templates in &lt;script&gt; elements.Typically velocity report is generated in several steps:</p>
				<ol>
					<li>Printing a header</li>
					<li>Query data from datasource(s) and produce a report body.</li>
					<li>Printing a footer.</li>
				</ol>
				<p>
					<em>Primes</em> example demonstrates how to produce a simple report using Velocity.</p>
				<note>
				Velocity Driver does not support query element. This limitation may be eliminated in future, but currently we do not see Velocity strengths for querying the data.
				JDBC or Janino drivers provide more powerful and easy-to-use solutions for queries.
				</note>
			</section>
		</section>
		<section>
			<title>Examples</title>
			<p>Download Scriptella examples from <a href="../download.html">Downloads</a> page.
            The examples are ready to run, although you may have to download additional third party jars,
                which cannot be redistributed, e.g. jdbcldap.jar etc. These dependencies are
                specified in lib/readme.txt file.
            </p>
			<table>
				<tr>
					<td>Ant</td>
					<td>This example demonstrates integration with ant.</td>
				</tr>
				<tr>
					<td>CSV</td>
					<td>Example of working with CSV data using HSQLDB CSV tables feature and opencsv library</td>
				</tr>
				<tr>
					<td>DB Upgrade</td>
					<td>This example shows how Scriptella can be used as a schema evolution tool.</td>
				</tr>
				<tr>
					<td>LDAP</td>
					<td>Example of migration script to exchange data between a database and LDAP directory.
                        This example shows 2 ways to access LDAP directories from Scriptella:
                        built-in LDAP driver and JDBC-LDAP Driver from OctetString.</td>
				</tr>
				<tr>
					<td>Music Store</td>
					<td>This script create a sample database of music track. This sample shows how to
                reference BLOB content in external files and use JDBC escaping syntax to pass dates
                independently from the DB locale/date/time settings.</td>
				</tr>
				<tr>
					<td>ODBC</td>
					<td>
                        Produces a HTML view of the MS Access Northwind Categories table.
                        This example demonstrates working with ODBC datasources (Northwind.mdb) and producing a report with images.
                    </td>
				</tr>
				<tr>
					<td>Primes</td>
					<td>Fills the database with prime numbers and produces HTML/CSV reports.
                    This example demonstrates a combined usage of Velocity, Janino, CSV Driver and SQL.</td>
				</tr>
			</table>
		</section>
		<section>
            <title>Best Practices</title>
            <p>This chapter describes Scriptella usage best practices. The following list provides general
                recommendations for Scriptella ETL scripts:</p>
            <ul>
                <li>Do not hardcode connection properties and other configuration settings e.g. driver names, urls, mode
                    flags etc. Use a property file like etl.properties to store ETL configuration parameters</li>
                <li>Use built-in Scriptella adapters for JDBC drivers if possible.</li>
                <li>Use &lt;dialect&gt; for database specific SQL parts. Use properties to configure data types similar
                    to domains, example:
                    <source>
CREATE TABLE User (
ID $INTEGER,
LOGIN $SMALL_STRING
);
--Values for $INTEGER AND $SMALL_STRING are
--stored in a mapping property file e.g. type-mapping.properties
--and easily reconfigurable for another DB vendor
                    </source>
                </li>
                <li>Use JDBC escaping to specify time and date literals, function calls and other parameters
                    independently from DB vendor. Examples:
                    <br/>
                    Calls without a return value:
                    <code>{ call procedure_name (argument1, argument2,...) }</code>
                    <br/>
                    Calls with a return value:
                    <code>{ ? = call procedure_name (argument1, argument2,...) }</code>
                    <br/>
                    Timestamp Literals:
                    <code>{ts 'yyyy-mm-dd hh:mm:ss.f...'}</code>
                    <br/>
                </li>

                <li>Use
                    <strong>.etl.xml</strong>
                    naming convention for ETL scripts. In this case it would be easy to recognize scriptella
                    files, moreover you wont have
                    to specify etl.xml extension to run ETL files. Example: typing
                    <code>scriptella init</code>
                    executes
                    <code>init.etl.xml</code>
                    automatically if no file
                    <code>init</code>
                    was found.
                </li>
                <li>For large bulk-insert files use &lt;include&gt; element to avoid loading a whole file into
                    memory.</li>
            </ul>
            <section>
                <title>Using Scriptella as a Database Schema Evolution Tool</title>
                <p>
                    <strong>dbupgrade</strong>
                    example shows how to build a simple database upgrade(downgrade) script. The following steps are
                    required to create a simple database upgrade framework:
                </p>
                <ul>
                    <li>If no DB present create an new database and fill it with up-to-date inital script</li>
                    <li>If old DB is present apply a set of incremental updates to migrate from version X to Y.</li>
                </ul>
                <p>Scriptella provides enough features to create a simple database upgrade framework, but the primary
                    one is the ability to work with several datasources.
                    This means you can change database vendors between builds and synchronize several datasources, e.g.
                    LDAP-Database.</p>
                <p>Scriptella is lightweight and can be easily added to a set of application libraries during
                    deployment. In this case you can integrate your schema upgrade solution
                    with application startup procedure typically written as a set of webapp context listeners or
                    initializer servlets.</p>

            </section>
		</section>
	</body>
</document>
