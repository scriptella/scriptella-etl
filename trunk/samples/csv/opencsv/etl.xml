<!DOCTYPE scriptella SYSTEM "scriptella.dtd">
<scriptella>
    <description>
        Imports CSV data from a file to a database table.
    </description>
    <connection id="in" driver="janino" classpath="../../lib/janino.jar;../../lib/opencsv-1.6.jar"/>
    <connection id="out" driver="hsqldb" url="jdbc:hsqldb:file:db" user="sa" classpath="../../lib/hsqldb.jar"/>
    <script connection-id="out">
        <!-- Creates Bug table to output CSV data -->
        DROP TABLE BUG IF EXISTS;
        CREATE TABLE Bug (
            ID INT PRIMARY KEY,
            PRIORITY VARCHAR(10),
            SUMMARY VARCHAR(200),
            STATUS VARCHAR(10)
        );
    </script>

    <query connection-id="in">
        import au.com.bytecode.opencsv.CSVReader;
        import java.io.*;
        CSVReader reader = new CSVReader(new FileReader("bugs_in.csv"));
        String[] header=reader.readNext();

        for (Object[] row; (row = reader.readNext()) != null;) {
            next(header, row);
        }
        <script connection-id="out">
            INSERT INTO Bug VALUES (?id, ?priority, ?summary, ?status);
        </script>
    </query>

</scriptella>